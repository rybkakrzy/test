import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormArray, FormGroup } from '@angular/forms';

@Component({
  selector: 'app-dynamic-checkbox-form',
  templateUrl: './dynamic-checkbox-form.component.html'
})
export class DynamicCheckboxFormComponent implements OnInit {

  form!: FormGroup;

  options = [
    { key: 'A', value: 'Option A' },
    { key: 'B', value: 'Option B' },
    { key: 'C', value: 'Option C' }
  ];

  constructor(private fb: FormBuilder) {}

  ngOnInit(): void {
    this.form = this.fb.group({
      selections: this.fb.array([]) // dynamiczna tablica checkboxÃ³w
    });

    this.addCheckboxes();
  }

  // Add one checkbox control for each option
  private addCheckboxes(): void {
    this.options.forEach(() =>
      (this.selectionsFormArray.push(this.fb.control(false)))
    );
  }

  // Helper getter
  get selectionsFormArray(): FormArray {
    return this.form.get('selections') as FormArray;
  }

  // Extract selected keys
  getSelectedKeys(): string[] {
    return this.form.value.selections
      .map((checked: boolean, i: number) => checked ? this.options[i].key : null)
      .filter((v: string | null) => v !== null) as string[];
  }

  // Simulate sending to API
  onSubmit(): void {
    const selectedKeys = this.getSelectedKeys();
    console.log('Send to API:', selectedKeys);
  }
}


<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <div formArrayName="selections">
    <div *ngFor="let option of options; let i = index">
      <label>
        <input type="checkbox" [formControlName]="i" />
        {{ option.value }}
      </label>
    </div>
  </div>

  <button type="submit">Submit</button>
</form>
